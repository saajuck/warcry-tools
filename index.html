<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Warcry Stat Comparator</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    label, input { display: block; margin: 0.25rem 0; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
    table { margin-top: 2rem; border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <h1>Warcry Stat Comparator</h1>

  <form id="form">
    <h2>Ajouter un personnage</h2>
    <div class="grid">
      <div><label>Nom <input name="nom" required /></label></div>
      <div><label>Coût <input type="number" value="1" name="cout" required /></label></div>
      <div><label>Attaques <input type="number" value="1" name="attaques" required /></label></div>
      <div><label>Force <input type="number" value="1" name="force" required /></label></div>
      <div><label>Dégâts <input type="number" value="1" name="degat" required /></label></div>
      <div><label>Critique <input type="number" value="1" name="degatCrit" required /></label></div>
      <div><label>PV <input type="number" value="1" name="pv" required /></label></div>
      <div><label>Endurance <input type="number" value="1" name="endurance" required /></label></div>
      <div><label>Mouvement <input type="number" value="1" name="movement" required /></label></div>
      <div><label>Portée <input type="number" value="1" name="range" required /></label></div>
    </div>

    <h2>Pondération des critères</h2>
    <div class="grid">
      <div><label>Coût <input type="number" name="coutPonderation" value="0.8" step="0.1" /></label></div>
      <div><label>Attaques <input type="number" name="attaquesPonderation" value="0.1" step="0.1" /></label></div>
      <div><label>Force <input type="number" name="forcePonderation" value="0.1" step="0.1" /></label></div>
      <div><label>Dégâts <input type="number" name="degatPonderation" value="0.1" step="0.1" /></label></div>
      <div><label>Critique <input type="number" name="degatCritPonderation" value="0.1" step="0.1" /></label></div>
      <div><label>Portée <input type="number" name="rangePonderation" value="0.05" step="0.1" /></label></div>
      <div><label>DPS <input type="number" name="dpsPonderation" value="0.8" step="0.1" /></label></div>
      <div><label>PV <input type="number" name="pvPonderation" value="0.2" step="0.1" /></label></div>
      <div><label>Endurance <input type="number" name="endurancePonderation" value="0.3" step="0.1" /></label></div>
      <div><label>Mouvement <input type="number" name="movementPonderation" value="0.3" step="0.1" /></label></div>
    </div>
    
    <button type="submit">Ajouter</button>
  </form>

  <table id="resultats"></table>

  <script>
    let data = [];
    let currentId = 0;

    function calculerDps({ attaques, degat, degatCrit }) {
      const pCrit = 1 / 6;
      const dpsParAttaque = (
        (1 / 3) * (pCrit * degatCrit + (4 / 6) * degat) +
        (1 / 3) * (pCrit * degatCrit + (2 / 6) * degat) +
        (1 / 3) * (pCrit * degatCrit + (1 / 6) * degat)
      );
      return +(attaques * dpsParAttaque).toFixed(3);
    }

    function comparer(entites, configCritères) {
      const minMax = {};
      for (const { champ } of configCritères) {
        const valeurs = entites.map(e => e[champ]);
        minMax[champ] = {
          min: Math.min(...valeurs),
          max: Math.max(...valeurs)
        };
      }

      return entites.map(entite => {
        let score = 0;
        for (const { champ, poids, optimiser } of configCritères) {
          const { min, max } = minMax[champ];
          let val = entite[champ];
          let norm = (max === min) ? 0.5 : (val - min) / (max - min);
          if (optimiser === "min") norm = 1 - norm;
          score += poids * norm;
        }
        return { ...entite, score: +score.toFixed(3) };
      }).sort((a, b) => b.score - a.score);
    }

    let PONDERATION = {
      cout: 0.8,
      attaques: 0.1,
      force: 0.1,
      degat: 0.1,
      degatCrit: 0.1,
      range: 0.05,
      dps: 0.8,
      pv: 0.2,
      endurance: 0.3,
      movement: 0.3
    };

    const criteres = [
      { champ: "cout", poids: PONDERATION.cout, optimiser: "min" },
      { champ: "attaques", poids: PONDERATION.attaques, optimiser: "max" },
      { champ: "force", poids: PONDERATION.force, optimiser: "max" },
      { champ: "degat", poids: PONDERATION.degat, optimiser: "max" },
      { champ: "degatCrit", poids: PONDERATION.degatCrit, optimiser: "max" },
      { champ: "range", poids: PONDERATION.range, optimiser: "max" },
      { champ: "dps", poids: PONDERATION.dps, optimiser: "max" },
      { champ: "pv", poids: PONDERATION.pv, optimiser: "max" },
      { champ: "endurance", poids: PONDERATION.endurance, optimiser: "max" },
      { champ: "movement", poids: PONDERATION.movement, optimiser: "max" },
    ];

    document.getElementById("form").addEventListener("submit", (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const entite = Object.fromEntries(formData.entries());

      for (const key in entite) {
        if (key !== "nom" && !key.includes("Ponderation")) entite[key] = parseFloat(entite[key]);
      }

      entite.dps = calculerDps(entite);
      entite.id = currentId++;

      data.push(entite);

      for (const [key, value] of formData.entries()) {
        if (key.includes("Ponderation")) {
          const crit = key.replace("Ponderation", "");
          PONDERATION[crit] = parseFloat(value);
        }
      }

      const results = comparer(data, criteres);
      afficherResultats(results);
      e.target.reset();
    });

    function supprimerEntite(id) {
      data = data.filter(e => e.id !== id);
      const results = comparer(data, criteres);
      afficherResultats(results);
    }

    function formatStatistiques(entite) {
      const stats = [
        { nom: 'A', value: entite.attaques },
        { nom: 'F', value: entite.force },
        { nom: 'E', value: entite.endurance },
        { nom: 'PV', value: entite.pv },
      ];
      return stats.map(stat => `${stat.nom} : ${stat.value}`).join(" | ");
    }

    function afficherResultats(payload) {
      const table = document.getElementById("resultats");
      if (payload.length === 0) {
        table.innerHTML = "";
        return;
      }

      
      const colonnesAAfficher = ["nom", "score", "cout", "dps", 'stats'];
      
      // Agrégation des stats avec leur première lettre et valeur
      const formatStat = (champ, val) => `${champ.charAt(0).toUpperCase()} : ${val}`;

      table.innerHTML = `
        <thead>
          <tr>
            ${colonnesAAfficher.map(c => `<th>${c}</th>`).join("")}
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          ${payload.map((row, index) =>
            `<tr>
              ${colonnesAAfficher.map(c => `<td>${c !== 'stats' ? row[c] : formatStatistiques( row )}</td>`).join("")}
              <td><button onclick="supprimerEntite(${index})">❌</button></td>
            </tr>`
          ).join("")}
        </tbody>
      `;
    }
  </script>
</body>
</html>
